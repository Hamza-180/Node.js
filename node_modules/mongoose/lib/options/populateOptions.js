'use strict';

const clone = require('../helpers/clone');

/**
 * PopulateOptions class
 * @constructor
 * @param {Object} obj - Options object
 */
class PopulateOptions {
  constructor(obj) {
    this._docs = {};
    this._childDocs = [];

    if (obj == null) {
      return;
    }
    obj = clone(obj);
    Object.assign(this, obj);

    if (typeof obj.subPopulate === 'object') {
      this.populate = obj.subPopulate;
    }

    if (obj.perDocumentLimit != null) {
      if (obj.limit != null) {
        throw new Error('Can not use `limit` and `perDocumentLimit` at the same time. Path: `' + obj.path + '`.');
      }
      if (typeof obj.perDocumentLimit !== 'number' || obj.perDocumentLimit < 1) {
        throw new Error('`perDocumentLimit` must be a positive number. Path: `' + obj.path + '`.');
      }
    }
  }
}

/**
 * The connection used to look up models by name. If not specified, Mongoose
 * will default to using the connection associated with the model in
 * `PopulateOptions#model`.
 * @memberOf PopulateOptions
 * @property {Connection} connection
 * @api public
 */

module.exports = PopulateOptions;
